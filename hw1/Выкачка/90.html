<!DOCTYPE html>
<html data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D" lang="ru">
<head>



<title>Разгон игры «Fred» для ZX Spectrum / Хабр</title>














































</head>
<body>
<div data-async-called="true" data-server-rendered="true" id="app"><div class="tm-layout__wrapper"><!-- --> <div></div> <div class="tm-feature tm-feature"><!-- --></div> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><div class="tm-header__burger-nav"><button class="tm-header__button tm-header__button_burger" type="button"><svg class="tm-svg-img tm-header__icon tm-header__icon-burger" height="16" width="16"><title>Меню</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#header-burger"></use></svg></button></div> <span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_ru" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <!-- --> <div class="tm-header-user-menu tm-header_user-menu"><a class="tm-header-user-menu__item tm-header-user-menu__search" href="/ru/search/"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#search"></use></svg></a> <!-- --> <!-- --> <!-- --> <div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="menu-toggle-guest"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_white" height="24" width="24"><title>Профиль</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#header-user"></use></svg></button> <!-- --></div> <!-- --></div></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <!-- --> <!-- --> <div class="tm-page-width"></div> <main class="tm-layout__container"><div class="tm-page" data-async-called="true" hl="ru"><div class="tm-page-width"><!-- --> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><!-- --> <div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__arrow" height="24" width="24"><title>Обновить</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a class="tm-user-info__userpic" href="/ru/users/kmatveev/" title="kmatveev"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_green" height="32" width="32"><!-- --> <use xlink:href="/img/megazord-v28.617e16ca..svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a class="tm-user-info__username" href="/ru/users/kmatveev/">
      kmatveev
      <!-- --></a> <span class="tm-article-datetime-published"><time datetime="2023-03-09T16:47:32.000Z" title="2023-03-09, 19:47">9  мар   в 19:47</time></span></span></span></div> <!-- --></div> <h1 class="tm-article-snippet__title tm-article-snippet__title_h1" lang="ru"><span>Разгон игры «Fred» для ZX Spectrum</span></h1> <div class="tm-article-snippet__stats"><div class="tm-article-complexity tm-article-complexity_complexity-medium"><span class="tm-svg-icon__wrapper tm-article-complexity__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Уровень сложности</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#complexity-medium"></use></svg></span> <span class="tm-article-complexity__label">
    Средний
  </span></div> <div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#clock"></use></svg></span> <span class="tm-article-reading-time__label">
    15 мин
  </span></div> <span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.5K</span></span></div> <div class="tm-article-snippet__hubs-container"><div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link" href="/ru/hub/gamedev/"><span>Разработка игр</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link" href="/ru/hub/reverse-engineering/"><span>Реверс-инжиниринг</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-article-snippet__hubs-item"><a class="tm-article-snippet__hubs-item-link" href="/ru/hub/games/"><span>Игры и игровые консоли</span> <!-- --></a></span></div></div> <div class="tm-article-snippet__labels-container"><div class="tm-article-snippet__labels"><!-- --> <div class="tm-article-snippet__label tm-article-snippet__label tm-article-snippet__label_variant-sandbox"><a href="/ru/sandbox/">
          Из песочницы
        </a></div></div></div> <!-- --> <!-- --></div></div> <!-- --> <div class="tm-article-body" data-gallery-root="" lang="ru"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><p>В один из недавних дней, возвращаясь с работы в транспорте, я, как обычно, отпустил мысли бродить куда им захочется, и они неожиданно забрели в самое начало девяностых, когда я был подростком и у меня был мой первый компьютер, самодельный клон ZX Spectrum 48. Я вспомнил первую игру, которая у меня была, Fred. Проникнувшись воспоминаниями, я добрался до дома, запустил эмулятор и поиграл минут 30, игра хорошая, рекомендую. Но выглядит игра по нынешним временам дёргано, я стал капризным и люблю много fps. А может быть, её можно как-то ускорить без титанических усилий, подумал я. Оказалось - да, можно. </p><figure class=""><img alt="Это Fred" data-src="https://habrastorage.org/getpro/habr/upload_files/81d/932/3ee/81d9323eef7130b52e5b36ac105c8be1.png" height="385" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/81d/932/3ee/81d9323eef7130b52e5b36ac105c8be1.png" title="Это Fred" width="512"/><div><figcaption>Это Fred</figcaption></div></figure><h2>Как в это играть</h2><p>Это раздел для тех, кто совсем не знает, что такое ZX Spectrum, или очень сильно забыл.  Чтобы поиграть в игры, понадобится эмулятор. Самый крутой - Spectaculator, но он стоит денег. Есть много бесплатных и весьма качественных, попробуйте разные, мне нравятся ZX Spin и Klive. Важное уточнение: существует несколько моделей ZX Spectrum, большинство эмуляторов позволяет выбрать, какую модель эмулировать. Для нас подойдёт классика ZX Spectrum 48. Ещё нужно скачать файл с игрой, и эти файлы бывают разные, об этом чуть ниже.</p><p>Сразу после включения или сброса, после быстрого тестирования памяти мы увидим надпись "(c) 1982 Sinclair Research Ltd" на белом фоне, и это означает, что интерпретатор BASIC готов к работе, можно нажать какую-нибудь клавишу, например ENTER. Если вам совершенно не интересно разбираться в том, как работать на этой древней машине, а хочется просто поиграть в игры, то у меня для вас хорошая новость: это вполне возможно. Игры для ZX Spectrum доступны для эмуляторов в нескольких форматах. Первый тип форматов - полные снапшоты состояния компьютера, хранятся в файлах с расширениями .sna или .z80. Такие снапшоты обычно создаются, когда игра полностью загружена и показывает главное меню. Вам достаточно просто открыть файл со снапшотом в эмуляторе, и можно играть. Второй тип форматов - образы магнитной ленты или дискеты, хранятся в файлах с расширениями .tap, .tzx, .dsk. Они подключаются к эмулятору и изнутри выглядят как кассета в магнитофоне или дискета в дисководе. Дальше с файлами, хранящимися в образе, можно работать, используя команды операционной системы эмулируемого компьютера. Однако эмуляторы и тут приходят на помощь, многие из них умеют заставить эмулируемый компьютер автоматически загружать файлы из образов, да ещё и в ускоренном режиме. Если вы разобрались, как это сделать в вашем эмуляторе, и вам полностью достаточно такого способа - это прекрасно, можете пропустить следующие абзацы.</p><p>Итак, сразу после включения запускается интерпретатор BASIC, который находится в ROM эмулируемого компьютера. Этот интерпретатор также выполняет роль примитивной операционной системы. Нижняя часть экрана - это область ввода и редактирования команд. Реализация ZX Spectrum BASIC необычна тем, что в ней операторы вводятся не побуквенно, а сразу, целиком. Когда редактор отображает мигающий курсор "K" (что означает "keyword"), то каждая клавиша соответсвует оператору, который будет введён при её нажатии. Иногда соответствие клавиш и операторов вполне интуитивно ("P" -&gt; "PRINT", "L" -&gt; "LET", "F" -&gt; "FOR", "N" -&gt; "NEXT", "G"-&gt;"GOTO"), для остальных можно определить экспериментально. В старые времена пользователи покупали наклейки на клавиатуры, сейчас большинство эмуляторов имеет окошко с подсказкой по спектрумовской клавиатуре, на котором можно увидеть, что кнопок на спектрумской клавиатуре немного, всего 40, поэтому кнопки совмещают много функций. </p><figure class="full-width"><img alt="Окно эмулятора и экранная клавиатура" data-src="https://habrastorage.org/getpro/habr/upload_files/39b/266/80f/39b26680ff3647f4ac5c05c22af5c83c.png" height="363" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/39b/266/80f/39b26680ff3647f4ac5c05c22af5c83c.png" title="Окно эмулятора и экранная клавиатура" width="765"/><div><figcaption>Окно эмулятора и экранная клавиатура</figcaption></div></figure><p>После ввода оператора курсор сменится на мигающую "L" ("letter"), и редактор будет воспринимать нажатия клавиш как отдельные буквы. У ZX Spectrum есть две shift-клавиши: CapsShift, которую нужно удерживать, чтобы набрать заглавные буквы, и SymbolShift, которую нужно удерживать, чтобы набирать символы, расположенные на тех же клавишах, что и буквы/цифры. В оригинальном ZX Spectrum они располагались так: CapsShift внизу слева, SymbolShift внизу справа, а сейчас в разных эмуляторах эти клавиши отображаются на клавиатуру по-разному: иногда это левый и правый Shift, а иногда задействуются Ctrl или Alt, иногда это можно поменять в настройках. Проверьте свой эмулятор, набрав, например, PRINT "Hello", пусть это будет вашим первым испытанием. Стирать неправильный ввод можно, нажав CapsShift и 0, это спектрумовский backspace, но многие эмуляторы понимают и современный backspace. Ключевые слова операторов стираются также целиком. Когда вы нажмёте ENTER, то интерпретатор сразу исполнит введённую команду, если в ней нет BASIC-овского номера строки в начале, если же есть, то строка добавится в текст текущей программы. Попробуйте выполнить вышеуказанный PRINT.</p><p>Чтобы загрузить программу с магнитофонной ленты, нужно набрать LOAD "". На всякий случай, это делается так: нажать "j", на экране напечатается ключевое слово "LOAD", потом нажать SymbolShift (это может быть правый Shift, или правый Ctrl, или правый Alt) и два раза "p", напечатаются кавычки, потом нажать ENTER. Большинство детей, которым родители покупали Спектрумы для игр, полностью обходились этим набором действий. После ввода этой команды бордюр экрана начинает медленно мигать красным и голубым цветами, ожидая сигнала от магнитофона. В старые времена нужно было нажать кнопку воспроизведения, а сейчас нужно открыть в эмуляторе файл с образом магнитной ленты (расширения файлов .tap или .tzx), после чего нажать виртуальную кнопку воспроизведения. Файлы, записанные на магнитной ленте, начинаются с пилотного сигнала, который звучит как чистый тон в течении примерно 3 секунд, он нужен для подстройки фазы считывателя. И сразу же после пилотного сигнала начиналась какофония звуков, которую можно было слушать примерно 5 минут, пока игра загружалась, полоски на бордюре при этом сменялись на сине-жёлтые. Если вы настоящий хардкорный фанат, или хотите проникнуться духом эпохи, то вы непременно должны терпеливо ждать, пока программа полностью загрузится. Для тех же, кто хочет просто поиграть, большинство эмуляторов умеют выполнять быструю загрузку.</p><figure class=""><img alt="Так происходит загрузка игры" data-src="https://habrastorage.org/getpro/habr/upload_files/ac6/821/761/ac6821761f4deed1da959a70438b0faa.gif" height="296" src="https://habrastorage.org/getpro/habr/upload_files/ac6/821/761/ac6821761f4deed1da959a70438b0faa.gif" title="Так происходит загрузка игры" width="352"/><div><figcaption>Так происходит загрузка игры</figcaption></div></figure><p>Задача игры в том, что оказавшись на самом нижнем уровне лабиринта, выбраться из него, найдя выход, расположенный на самом верху. Лабиринт генерируется случайно. Трудность в том, что игроку видна лишь малая часть лабиринта вокруг него, потому что графика в игре крупная (и мультяшная). К счастью, петель в лабиринте нет, только развилки и тупики. И, конечно же, лабиринт населён врагами, которых становится больше при продвижении в следующие уровни игры. На первом уровне вам противостоят ёжики, через которых надо прыгать (точнее прыгать надо на месте, ёжик сам пробежит под вами), ядовитые капли, и страшные привидения без головы, которые умеют проходить через стены. У вас вроде бы есть пистолет, но по ёжикам он не попадает, потому что они слишком мелкие, а привидению на пули почти пофиг, они могут только поменять направление движения. Так что на пистолет полагаться не стоит, но он станет полезнее против врагов, которые появляются на новых уровнях</p><h2>Технические подробности</h2><p>ZX Spectrum работает на процессоре Z80, который способен адресовать 64 кбайт памяти, и в данном компьютере эта память распределена так: нижние 16 кбайт отображаются в ROM, в которой прошит интерпретатор BASIC-а, остальные 48 кбайт - это RAM, включающая видео-память. Экран состоит из центральной части с разрешением 256x192 пикселей, и цветного бордюра. У ZX Spectrum имеется единственный видеорежим, и весь видеовывод сводится к записи в видеопамять. По адресам 4000-57FF расположена область пикселей, в которой каждому байту соответствует горизонтальная группа из 8 пикселей, то есть по одному биту на пиксель. По адресам 5800 расположена область цветовых атрибутов, каждый байт которой определял два цвета для группы 8x8 пикселей: один цвет для пикселей со значением 1 (цвет тона, на Спектруме известен как INK), и второй цвет - для пикселей со значением 0 (цвет фона, на Спектруме известен как PAPER). Такую группу пикселей мы будем дальше называть блоком-ячейкой или блоком-клеткой, весь экран делился на 32x24 ячейки. Казалось бы, такая грубая возможность раскраски подходит только для трёх случаев: вывод цветного текста (одна буква - один блок-ячейка), вывод монохромной графики достаточно высокого разрешения (не обязательно чёрно-белой, можно выбрать два любых цвета), и вывод грубой цветной блочной графики. При попытке нарисовать что-то цветное высокого разрешения происходило наложение цветов, знаменитый color clash.</p><figure class="full-width"><img alt="Увеличенное изображение из игры, жёлтые линии показывают границы блоков-ячеек" data-src="https://habrastorage.org/getpro/habr/upload_files/766/15c/62d/76615c62dd73609b33962bada84d542d.png" height="338" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/766/15c/62d/76615c62dd73609b33962bada84d542d.png" title="Увеличенное изображение из игры, жёлтые линии показывают границы блоков-ячеек" width="577"/><div><figcaption>Увеличенное изображение из игры, жёлтые линии показывают границы блоков-ячеек</figcaption></div></figure><p>Однако авторы игр со временем выработали приёмы игрового дизайна для обхода этих ограничений. Адресация видеопамяти обладает ещё вот какой особенностью: при переходе на следующий адрес в области пикселей мы сдвинемся вправо, но дойдя до правого края строки (в которой 32 байта) мы попадём не на следующую строку, а на 8 строк ниже, потом ещё на 8 строк ниже, и так 8 раз. Только после этого адрес станет указывать на вторую строку пикселей. Иными словами, последовательное увеличение адресов видеопамяти формирует через-8-строчную развёртку. Это можно наблюдать на анимированной картинке выше: когда игра загружается, то байты считываются с ленты последовательно в видеопамять, рисуя заставку. Такая адресация означает, что для сдвига к группе пикселей справа нужно увеличить адрес на 1, а для сдвига к группе пикселей вниз, в пределах одного блока-ячейки, нужно увеличить старший байт адреса на 1. Это знание нам очень пригодится.</p><h2>Анализ</h2><p>Попробуем применить наше знание для анализа того, как выглядит и отрисовывается игра. Даже не заглядывая внутрь игры мы можем уже многое сказать о её устройстве. Лабиринт состоит из больших блоков размером 4x5 клеток (32x40 пикселей), каждый блок лабиринта окрашен в один цвет. Скроллинг в игре выполняется с шагом в 1 блок-ячейку (8 пикселей), что позволяет избегать наложения цветов на стыках блоков лабиринта. Враги также двигаются с шагом в 8 пикселей.</p><p>В старые времена этот скроллинг по 8 пикселей казался вполне терпимым. Но игра прорисовывает экран очень медленно, что делает процесс очень дёрганным. Может, это и неплохо, есть время подумать и игра становится немного стратегичной, но мне очень захотелось сделать движение в игре визуально плавнее. Я верил, что это возможно, потому что существуют игры с гораздо более плавным скроллингом, например моя любимая Soldier of Fortune. Значит, нужно уменьшить паузы между кадрами.</p><p>Бывают разные подходы к анализу игр, написанных на ассемблере. Можно попробовать идти по коду последовательно с точки запуска игры. Мне больше нравится другой подход: найти, какой участок кода пишет в видеопамять, и дальше раскручивать в обратную сторону. У этого подхода есть полезная особенность: очень часто рисование в видеопамяти и является той частью программы, где процессор производит больше всего работы. В случае Fred если несколько раз понажимать в эмуляторе кнопку "остановить игру и показать отладчик", а в отладчике поглядеть на регистры, вдруг они содержат что-то, похожее на видеоадрес, то можно быстро найти нужную нам процедуру отрисовки. </p><p>Код этой процедуры очень понятный, можно даже сказать что он слишком очевидный и чуть-чуть наивный. Это не насмешка и не выпендрёж, наоборот, простота и ясность этого кода мне очень нравятся. Так писали в 1983 году. Нам повезло, что эта процедура очень компактная. Листинг нужно понимать так: для некоторых команд перед ними стоит адрес, по которому эти команды расположены в памяти, для читабельности я оставил адреса только для тех команд, на которые делается переход. Шестнадцатеричные числа записываются со знаком доллара в начале.  </p><pre></pre><p>Процедура отрисовки динамического игрового экрана состоит из трёх вложенных друг в друга циклов. Самый внешний цикл идёт сверху вниз по 8-пиксельным строкам, внутренний цикл идёт слева направо блоками/клетками 8x8 пикселей внутри одной строки, и самый внутренний цикл идёт внутри клетки сверху вниз строчками 8 пикселей в ширину и 1 пиксель в высоту, каждая из которых занимает 1 байт. Информация о том, как отрисовать клетку 8x8 закодирована двумя байтами, причём старшие 3 бита описывают цвет, остальные 13 бит - смещение, по которому хранятся 8 байт пикселей. Итого, при превращении закодированного экрана в отрисованный экран получается распаковка 2 байта в 9 байт (8 байт пикселей и 1 байт цвета). Зачем нужен закодированный экран, почему не отрисовывать сразу? Есть две причины. Во-первых, наличие промежуточного представления экрана позволяет заполнять это промежуточное представление по частям: одна процедура рисует стены, верёвки и остальные статические элементы лабиринта, другая процедура рисует персонаж игрока, третья процедура рисует врагов, и так далее. Во-вторых, лабиринт состоит из блоков 4x5 клеток (32x40 пикселей), и при шаге скроллинга 8 пикселей ясно, что очень часто будет так, что блоки по краям будут отрисованы не полностью. Вместо того, чтобы делать сложную логику обрезания блоков, в игре используется промежуточная область чуть больше, чем видимый размер экрана, и хранится смещение видимой области. Это означает, что не далеко не каждый скроллинг приведёт к пересчёту закодированного экрана, чаще всего только изменится смещение, и перерисуется видимый экран.</p><p>В качестве счётчика самого внешнего цикла выступает регистр B, в качестве счётчика внутреннего цикла выступает регистр C. Поскольку эти регистры портятся внутри циклов, значения счётчиков сохраняются на стеке. Закодированный экран хранится построчно, слева направо, поэтому для перехода на следующую блок-клетку вправо нужно перейти к двум следующим байтам. Логично, что и видимый экран рисуется в том же порядке. Итого два внешних цикла двигаются по элементам и закодированного экрана и видимого экрана, самый внутренний цикл копирует байты, принадлежащие одной клетке. Во внешних циклах на элемент закодированного экрана указывает регистровая пара HL, а на видимую область указывают два значения: регистр D, хранящий номер однопиксельной строки, соответствующей самым верхним строкам блоков-ячеек, и регистр E, указывающий на номер 8-пиксельного байта в строке. Чтобы превратить эти два значения в видео-адрес, вызывается вспомогательная процедура, расположенная по адресу $62D3, после которой вызывается ещё одна вспомогательная процедура $6442, которая занимается вычислением адреса в области цветовых атрибутов. При движении слева направо в цикле по блокам-клеткам внутри строки инкрементируются и горизонтальный указатель регистр E, и указатель за закодированый блок регистр HL (инкрементируется два раза, конечно).  Счётчиком самого внутреннего цикла снова выступает регистр B. Тут происходит просто копирование байтов пикселей из памяти в видеопамять, а чтобы перейти на строку вниз, увеличивается старший байт видеоадреса. </p><p>Cразу становится понятно, почему скроллинг в игре идёт по блокам-клеткам: так проще записывать байты, требуется только копирование. Горизонтальная группа в 8 пикселей хранится как 1 байт, и для плавного горизонтального скроллинга пришлось бы этот байт сдвигать побитово, и ещё накладывать на хвост от сдвига байта, расположенного левее. Во-первых, это всё медленные операции, во-вторых, это плохо сочетается с заполнением байтов в блоке сверху вниз. Ну, а раз уж плавный горизонтальный скроллинг сделать сложно, то и вертикальный не нужен.</p><p>Опытные спектрумисты ещё при просмотре листинга сразу поняли, что эту процедуру можно очень сильно ускорить. При отрисовке экрана в проходе по строке слева направо совершенно не требуется каждый раз вычислять адрес видеопамяти, достаточно просто инкрементировать его, а для хранения мы можем использовать те регистры, которые содержали номер строки и столбца. Также нам не нужно каждый раз вычислять адрес в области цветовых атрибутов, вместо этого можно хранить его в какой-нибудь регистровой паре и инкрементировать. Вычисление адреса в видеопамяти будем делать один раз, в начале строки. Это будут фундаментальные оптимизации, и помимо них можно сделать ещё несколько оптимизаций поменьше, на уровне отдельных команд процессора, выигрывая байты кода и такты исполнения.</p><h2>Оптимизация</h2><p>На первом шаге я хотел бы вносить в игру минимальные и компактные изменения, чтобы в результате получился небольшой патч, который можно было бы применить к готовой игре. В старые времена это позволило бы опубликовать листинг в журнале, чтобы читатели самостоятельно могли повторить изменения у себя. Чтобы достичь компактности, я постараюсь написать код, который уместится, заменив старый. Для этого придётся экономить команды и регистры. И ещё у меня есть одна слабость: я хотел бы, чтобы новый код был простым и понятным, странное желание для ассемблерного кода.</p><pre></pre><p>Пройдёмся по изменениям. Чтобы код остался компактным, я постарался уменьшить количество сохранений на стек и перемещения данных между регистрами, для чего пришлось продумать хранение значений в регистрах. Регистровая пара BC хранит указатель на текущую закодированную ячейку, пара DE - адрес в видеопамяти, IX - адрес в памяти цветовых атрибутов, пара HL используется для вычислений. Счётчики для внешнего и внутреннего циклов хранятся в регистре A и в альтернативном регистре A, потому что так проще их уменьшать в конце цикла.</p><p>Самая глобальная оптимизация - перенос вызова процедуры вычисления адреса в видеопамяти во внешний цикл. Сразу же вызывается процедура, которая вычислит адрес в памяти цветовых атрибутов. Во внутреннем цикле есть оптимизации поменьше. Чтобы разбить код ячейки на цвет и смещение адреса пикселей, я вместо цикла (который требует регистр для счёта циклов, которых 3), в котором использовались двухбайтовые команды сдвига SLA и RL, я отдельно выделяю цвет через быстрые однобайтовые команды сдвига RLCA, и отдельно умножаю смещение на 8 через сложение его с самим собой. Старый вариант занимал примерно 110 тактов процессора, новый занимает 62 такта. Далее, полный адрес источника пикселей получаем, добавляя смещение к базе, которая равна $9400, и мы можем добиться этого экономнее, сложив только старшие байты смещения и базы. Для самого внутреннего цикла мы очень хотим использовать в качестве счётчика регистр B, потому что он задействован в самой быстрой и компактной команде для циклов DJNZ. Значит, нам придётся сохранить регистровую пару BC на стеке, что позволит нам заодно занять регистр C для временного хранения значения из регистра D вместо того, чтобы сохранять весь DE на стеке. В самом внутреннем цикле можно добиться крохотной экономии тактов процессора, увеличивая только младший адрес источника пикселей.</p><p>В старом варианте процедуры шаг внутреннего цикла выполнялся 904 такта процессора, новый же выполняется 476 тактов. Со старой процедурой игра обновляла экран примерно каждые 224 миллисекунды (что примерно 4.5 fps), с новой процедурой между обновлениями экрана проходит 153 миллисекунды (что примерно 6.5 fps). По моим ощущениям играется ощутимо бодрее, мои старые игровые рефлексы перестали работать.</p><h2>Что дальше</h2><p>Итак, шаг внутреннего цикла после оптимизаций выполняется 476 тактов, из которых 280 тактов занимает самый внутренний цикл, то есть копирование из памяти в память.</p><p>Как ещё можно ускорить игру? Есть несколько идей.</p><ol><li><p>Если присмотреться к игровому экрану, то визуально он примерно на четверть состоит из пустой черноты. Если для пустых блоков-ячеек вообще пропускать отрисовку пикселей (включая расчёт расположения источника), это дало бы отличный прирост скорости. Для этого нужно проверить, каким кодом обозначаются пустые блоки-ячейки.</p></li><li><p>Блоки-ячейки кодируются неоптимально: чтобы выделить цвет из старших трёх битов кода ячейки и получить смещение пикселей, кратное 8, приходится выполнять много действий. Было бы быстрее, если бы цвет хранился в трёх младших битах. Но чтобы это изменить, придётся найти все места, где заполняется закодированный экран.</p></li><li><p>Самый внутренний цикл можно развернуть. Не обязательно все 8 проходов.</p></li><li><p>Копирование из памяти в память по одному байту - это медленно. Занятная особенность процессора Z80 состоит в том, что самые быстрые операции с памятью - это стековые операции PUSH и POP. Они мало того, что пишут/читают по два байта за раз, так ещё и сдвигают указатель стека на два байта, что делает их очень удобными для последовательных действий с памятью</p></li></ol><p>Все эти оптимизации потребуют более глубокого изучения игры и более глобального вмешательства в её код. Даже такое локальное изменение, как раскрутка цикла, приведёт к тому, что код не уместится поверх старого, а выносить процедуру в другое место и обновлять её адрес в месте вызова мне не хочется, очень много хлопот. Переписывание процедуры на использование стека увеличит её размер. Поэтому обо всех этих оптимизациях мы расскажем в следующей статье.</p><h2>Где взять?</h2><p><a href="https://github.com/kmatveev/zx-fred-reveng/tree/main/turbofred-1" rel="noopener noreferrer nofollow">https://github.com/kmatveev/zx-fred-reveng/tree/main/turbofred-1</a></p><p>можно скачать снапшот или .tap-файл</p><p></p></div></div></div> <!-- --> <!-- --></div> <!-- --> <!-- --></div> <!-- --> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bzx%20spectrum%5D">zx spectrum</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hub/gamedev/">Разработка игр</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hub/reverse-engineering/">Реверс-инжиниринг</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hub/games/">Игры и игровые консоли</a></li></ul></div></div></article></div> <!-- --></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 26: ↑25 и ↓1</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#counter-rating"></use></svg> <span class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating" title="Всего голосов 26: ↑25 и ↓1">+24</span></div> <div class="v-portal" style="display:none;"></div></div> <!-- --> <!-- --> <button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#counter-favorite"></use></svg></span> <span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">
    20
  </span></button> <div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg class="tm-sharing__icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z" fill="currentColor"></path></svg></button> <div class="v-portal" style="display:none;"></div></div> <div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a class="tm-article-comments-counter-link__link" href="/ru/post/721386/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      7
    </span></a> <!-- --></div> <!-- --> <div class="v-portal" style="display:none;"></div></div></div></div> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!-- --> <div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><!-- --> <div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a class="tm-user-card__userpic tm-user-card__userpic_size-40" href="/ru/users/kmatveev/"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_green"><!-- --> <use xlink:href="/img/megazord-v28.617e16ca..svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 12 голосов "><div class="tm-counter-container__header"><div class="tm-karma__votes tm-karma__votes_positive">
      10
    </div></div> <div class="tm-counter-container__footer"><div class="tm-karma__text">
      Карма
    </div> <div class="v-portal" style="display:none;"></div></div></div> <div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"> <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!-- --> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating"><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating">
        24
      </span></div> <!-- --></div></div> <div class="tm-counter-container__footer"><span class="tm-rating__text tm-rating__text">
      Рейтинг
    </span></div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article"><!-- --> <a class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article" href="/ru/users/kmatveev/">
          @kmatveev
        </a> <!-- --></div> <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article"><!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div></div> <!-- --></div> <div class="v-portal" style="display:none;"></div></div> <!-- --></section> <div class="tm-adfox-banner__container tm-page-article__banner"><!-- --> <div class="tm-adfox-banner tm-adfox-banner tm-adfox-banner_variant-leaderboard" id="adfox_164725660339535756"></div></div> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" href="/ru/post/721386/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 7 
    </span></a> <!-- --></div></div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2> </div> <!-- --></header> <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><div class="tm-tabs tm-tabs"><div><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim">
        Лучшие за сутки
      </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim">
        Похожие
      </button></span></div> <!-- --></div> <div class="similar-and-daily__tab-view"><div><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-article-cards"><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --></div></div> <!-- --></section> <section class="tm-block tm-stories-block tm-block tm-block_spacing-around" data-async-called="true" data-navigatable="" tabindex="0"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Истории</h2> </div> <!-- --></header> <div class="tm-block__body tm-block__body tm-block__body_variant-equal"><div class="tm-stories-empty"><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div> <div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div> <div class="tm-stories-card-empty__title-block"></div></div></div></div> <!-- --></div> <!-- --></section> <div><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-inset tm-placeholder-courses"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div> <div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div> <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div> <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div> <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div> <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div> <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li></ul></div> <div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --> <div><div><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div> <div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div> <div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div> <div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div> <div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div> <div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div> <div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div> <div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div> <div class="tm-placeholder-promo__dot"></div> <div class="tm-placeholder-promo__dot"></div></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div></div> <section class="tm-block tm-block tm-block_spacing-top" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Работа</h2> </div> <!-- --></header> <div class="tm-block__body tm-block__body"><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/unity_developer" target="_blank">
        Unity разработчик
      </a> <div class="tm-vacancies-block__vacancies-count">
        3
    вакансии
      </div></div><div class="tm-vacancies-block__item"><a class="tm-vacancies-block__vacancy-title" href="https://career.habr.com/vacancies/game_developer" target="_blank">
        Разработчик игр
      </a> <div class="tm-vacancies-block__vacancies-count">
        79
    вакансий
      </div></div></div> <footer class="tm-block__footer"><a class="tm-block-extralink" href="https://career.habr.com/catalog">
      Все вакансии
    </a></footer></section></div></div></div></div></div> <div class="tm-page__sidebar"><!-- --></div></div></div></div></main> <!-- --></div> <!-- --> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><div class="tm-footer__title"><a class="tm-svg-icon__wrapper tm-footer__title-link router-link-active" href="/ru/"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div> <div class="tm-footer__social"><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <div class="v-portal" style="display:none;"></div> <button class="tm-footer__link"><svg class="tm-svg-img tm-footer__icon" height="16" width="16"><title>Язык</title> <use xlink:href="/img/megazord-v28.617e16ca..svg#lang"></use></svg>
        Настройка языка
      </button> <a class="tm-footer__link" href="/ru/feedback/">
        Техническая поддержка
      </a> <a class="tm-footer__link" href="/berserk-mode-nope">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2023, </span> <span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div></div></div> <!-- --> <!-- --></div> <div class="vue-portal-target"></div></div>





<noscript>
<div>
<img alt="" src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;"/>
</div>
</noscript>


</body>
</html>
